<mvc:View
    controllerName="productmanagement.products.controller.ProductDetailsPage"
    xmlns:mvc="sap.ui.core.mvc"
    xmlns="sap.uxap"
    xmlns:l="sap.ui.layout"
    xmlns:tnt="sap.tnt"
    xmlns:m="sap.m"
    xmlns:core="sap.ui.core"
    xmlns:f="sap.ui.layout.form"
    core:require="{ formatMessage: 'sap/base/strings/formatMessage' }"
    height="100%"
>
    <ObjectPageLayout
        id="idProductPage"
        enableLazyLoading="true"
        showTitleInHeaderContent="false"
        showHeaderContent="{= !${productDetailsView>/IsCreateMode}}"
        showFooter="{productDetailsView>/IsEditMode}"
    >
        <headerTitle>
            <ObjectPageDynamicHeaderTitle>
                <expandedHeading>
                    <m:HBox alignItems="Center">
                        <m:Title
                            text="{= ${Name} || ${i18n>CreateProduct}}"
                            wrapping="true"
                        />
                        <tnt:InfoLabel
                            text="{i18n>New.Uppercase}"
                            colorScheme="8"
                            visible="{
                                path: 'ReleaseDate',
                                formatter: '.formatter.isNewFormatter'
                            }"
                            class="sapUiSmallMarginBegin"
                        />
                    </m:HBox>
                </expandedHeading>

                <snappedHeading>
                    <m:FlexBox
                        fitContainer="true"
                        alignItems="Center"
                    >
                        <m:Avatar
                            src="{Image}"
                            class="sapUiSmallMarginEnd"
                            visible="{= !${productDetailsView>/IsCreateMode}}"
                        />
                        <m:Title
                            text="{= ${Name} || ${i18n>CreateProduct}}"
                            wrapping="true"
                        />
                        <tnt:InfoLabel
                            text="{i18n>New.Uppercase}"
                            colorScheme="8"
                            visible="{
                                path: 'ReleaseDate',
                                formatter: '.formatter.isNewFormatter'
                            }"
                            class="sapUiSmallMarginBegin"
                        />
                    </m:FlexBox>
                </snappedHeading>

                <expandedContent>
                    <m:Text
                        text="{Description}"
                        visible="{= !${productDetailsView>/IsCreateMode}}"
                    />
                </expandedContent>

                <snappedContent>
                    <m:Text
                        text="{Description}"
                        visible="{= !${productDetailsView>/IsCreateMode}}"
                    />
                </snappedContent>

                <snappedTitleOnMobile>
                    <m:Title
                        text="{Description}"
                        visible="{= !${productDetailsView>/IsCreateMode}}"
                    />
                </snappedTitleOnMobile>

                <actions>
                    <m:Button
                        id="idEditProductButton"
                        type="Emphasized"
                        text="{i18n>Edit}"
                        icon="sap-icon://edit"
                        press="setEditMode"
                        visible="{= !${productDetailsView>/IsEditMode}}"
                    />
                    <m:Button
                        id="idDeleteProductButton"
                        type="Default"
                        text="{i18n>Delete}"
                        icon="sap-icon://delete"
                        press="onDeleteProductButtonPress"
                        visible="{= !${productDetailsView>/IsCreateMode}}"
                    />
                </actions>
            </ObjectPageDynamicHeaderTitle>
        </headerTitle>

        <headerContent>
            <m:FlexBox
                wrap="Wrap"
                fitContainer="true"
                alignItems="Center"
            >
                <m:Avatar
                    class="sapUiLargeMarginEnd sapUiSmallMarginBottom"
                    src="{Image}"
                    displaySize="L"
                />

                <m:VBox class="sapUiMediumMarginEnd sapUiSmallMarginBottom">
                    <m:Title text="{i18n>Price}" />
                    <m:ObjectNumber
                        class="sapMObjectNumberLarge"
                        number="{
                            parts: ['Price'],
                            type: 'sap.ui.model.type.Currency',
                            formatOptions: {currencyCode : false, groupingSeparator: ' ', decimals: 0 }
                        }"
                        unit="USD"
                        state="Information"
                    />
                </m:VBox>

                <m:VBox
                    class="sapUiMediumMarginEnd sapUiSmallMarginBottom"
                    visible="{= !!${DiscountDate}}"
                >
                    <m:Title text="{i18n>Status}" />
                    <m:ObjectStatus
                        class="sapMObjectStatusLarge"
                        text="{i18n>Sale.Uppercase}"
                        state="Success"
                    />
                </m:VBox>

                <m:VBox class="sapUiMediumMarginEnd sapUiSmallMarginBottom">
                    <m:Title text="{i18n>ReleaseDate}" />
                    <m:ObjectStatus
                        class="sapMObjectStatusLarge"
                        text="{
                            path: 'ReleaseDate',
                            type: 'sap.ui.model.type.Date'
                        }"
                    />
                </m:VBox>

                <m:VBox class="sapUiMediumMarginEnd sapUiSmallMarginBottom">
                    <m:Title text="{i18n>OnMarket}" />
                    <m:ObjectStatus
                        class="sapMObjectStatusLarge"
                        text="{
                            parts: [
                                'i18n>Days.WithAmount',
                                {
                                    path: 'ReleaseDate',
                                    formatter: '.formatter.passedDaysFormatter'
                                }
                            ],
                            formatter: 'formatMessage'
                          }"
                    />
                </m:VBox>
            </m:FlexBox>
        </headerContent>

        <sections>
            <ObjectPageSection
                id="idDetailsSection"
                title="{i18n>Details}"
                titleUppercase="false"
            >
                <ObjectPageSubSection>
                    <f:SimpleForm
                        id="idProductForm"
                        editable="{productDetailsView>/IsEditMode}"
                        layout="ResponsiveGridLayout"
                        adjustLabelSpan="false"
                        labelSpanXL="3"
                        labelSpanL="3"
                        labelSpanM="3"
                        labelSpanS="12"
                        emptySpanXL="2"
                        emptySpanL="2"
                        emptySpanM="2"
                        emptySpanS="0"
                        columnsXL="1"
                        columnsL="1"
                        columnsM="1"
                        validateFieldGroup="onProductDataFieldGroupValidate"
                    >
                        <f:content>
                            <m:Label
                                text="{i18n>Name}"
                                required="{productDetailsView>/IsEditMode}"
                            />
                            <l:VerticalLayout>
                                <m:Input
                                    name="Name"
                                    fieldGroupIds="ProductDataField,ProductName"
                                    placeholder="{i18n>ProductNamePlaceholder}"
                                    value="{
                                        path : 'Name',
                                        type : 'sap.ui.model.type.String',
                                        constraints : {
                                            minLength: 2
                                        }
                                    }"
                                    visible="{productDetailsView>/IsEditMode}"
                                    required="true"
                                />
                                <m:Text
                                    text="{Name}"
                                    visible="{= !${productDetailsView>/IsEditMode}}"
                                />
                            </l:VerticalLayout>

                            <m:Label
                                text="{i18n>Price}"
                                required="{productDetailsView>/IsEditMode}"
                            />
                            <l:VerticalLayout>
                                <m:Input
                                    name="Price"
                                    type="Number"
                                    fieldGroupIds="ProductDataField,Price"
                                    placeholder="{i18n>PricePlaceholder}"
                                    value="{
                                    path : 'Price',
                                    type : 'sap.ui.model.type.Float',
                                    formatOptions: { groupingSeparator: '', decimals: 0, decimalSeparator: '.' }
                                }"
                                    textAlign="Right"
                                    description="USD"
                                    visible="{productDetailsView>/IsEditMode}"
                                    required="true"
                                />
                                <m:Text
                                    text="{
                                        parts: [{ path: 'Price' }, { value: 'USD' }],
                                        type: 'sap.ui.model.type.Currency',
                                        formatOptions: { currencyCode : true, groupingSeparator: ' ', decimals: 0, decimalSeparator: '.' }
                                    }"
                                    visible="{= !${productDetailsView>/IsEditMode}}"
                                />
                            </l:VerticalLayout>

                            <m:Label
                                text="{i18n>Category}"
                                required="{productDetailsView>/IsEditMode}"
                            />
                            <l:VerticalLayout>
                                <m:MultiComboBox
                                    name="Subcategories"
                                    fieldGroupIds="ProductDataField,Subcategories"
                                    placeholder="{i18n>CategoryPlaceholder}"
                                    items="{
                                        path: 'categories>/',
                                        sorter: { path: 'Name' }
                                    }"
                                    selectedKeys="{Subcategories}"
                                    visible="{productDetailsView>/IsEditMode}"
                                    selectionChange="validateRequiredMultiComboBox"
                                    required="true"
                                >
                                    <core:Item
                                        key="{categories>Id}"
                                        text="{categories>Name}"
                                    />
                                </m:MultiComboBox>
                                <m:Text
                                    text="{Category/Name}"
                                    visible="{= !${productDetailsView>/IsEditMode}}"
                                />
                            </l:VerticalLayout>

                            <m:Label
                                text="{i18n>Subcategories}"
                                required="{productDetailsView>/IsEditMode}"
                            />
                            <l:VerticalLayout>
                                <m:MultiComboBox
                                    name="Subcategories"
                                    fieldGroupIds="ProductDataField,Subcategories"
                                    placeholder="{i18n>CategoryPlaceholder}"
                                    items="{
                                        path: 'categories>/',
                                        sorter: { path: 'Name' }
                                    }"
                                    selectedKeys="{Subcategories}"
                                    visible="{productDetailsView>/IsEditMode}"
                                    selectionChange="validateRequiredMultiComboBox"
                                    required="true"
                                >
                                    <core:Item
                                        key="{categories>Id}"
                                        text="{categories>Name}"
                                    />
                                </m:MultiComboBox>
                                <m:Text
                                    text="{
                                        path: 'Subcategories',                                       
                                        formatter: '.formatter.joinSubcategoriesFormatter'
                                    }"
                                    visible="{= !${productDetailsView>/IsEditMode}}"
                                />
                            </l:VerticalLayout>

                            <m:Label
                                text="{i18n>Description}"
                                required="{productDetailsView>/IsEditMode}"
                            />
                            <l:VerticalLayout>
                                <m:TextArea
                                    name="Description"
                                    fieldGroupIds="ProductDataField,Description"
                                    placeholder="{i18n>DescriptionPlaceholder}"
                                    width="100%"
                                    value="{
                                    path : 'Description',
                                    type : 'sap.ui.model.type.String',
                                    constraints : {
                                        minLength: 3,
                                        maxLength: 100
                                    }
                                }"
                                    growing="true"
                                    visible="{productDetailsView>/IsEditMode}"
                                    required="true"
                                />
                                <m:Text
                                    text="{Description}"
                                    emptyIndicatorMode='On'
                                    visible="{= !${productDetailsView>/IsEditMode}}"
                                />
                            </l:VerticalLayout>

                            <m:Label
                                text="{i18n>ReleaseDate}"
                                required="{productDetailsView>/IsEditMode}"
                            />
                            <l:VerticalLayout>
                                <m:DatePicker
                                    name="ReleaseDate"
                                    fieldGroupIds="ProductDataField,ReleaseDate"
                                    value="{
                                    path: 'ReleaseDate',
                                    type: 'custom.type.RequiredDate'
                                }"
                                    maxDate="{productDetailsView>/MaxReleaseDate}"
                                    visible="{productDetailsView>/IsEditMode}"
                                    required="true"
                                    change="onReleaseDatePickerChange"
                                />
                                <m:Text
                                    text="{
                                        path: 'ReleaseDate',                        
                                        type: 'sap.ui.model.type.Date'
                                    }"
                                    visible="{= !${productDetailsView>/IsEditMode}}"
                                />
                            </l:VerticalLayout>

                            <m:Label text="{i18n>DiscountDate}" />
                            <l:VerticalLayout>
                                <m:DatePicker
                                    id="idDiscountDate"
                                    name="DiscountDate"
                                    fieldGroupIds="ProductDataField,DiscountDate"
                                    value="{
                                        path: 'DiscountDate',
                                        type: 'sap.ui.model.type.Date'
                                    }"
                                    maxDate="{productDetailsView>/MaxDiscountDate}"
                                    minDate="{productDetailsView>/MinDiscountDate}"
                                    visible="{productDetailsView>/IsEditMode}"
                                />
                                <m:Text
                                    text="{
                                        path: 'DiscountDate',
                                        type: 'sap.ui.model.type.Date'
                                    }"
                                    emptyIndicatorMode='On'
                                    visible="{= !${productDetailsView>/IsEditMode}}"
                                />
                            </l:VerticalLayout>

                            <m:Label text="{i18n>Rating}" />
                            <l:VerticalLayout>
                                <m:RatingIndicator
                                    fieldGroupIds="ProductDataField,Rating"
                                    value="{Rating}"
                                    displayOnly="false"
                                    visible="{productDetailsView>/IsEditMode}"
                                />
                                <m:RatingIndicator
                                    value="{Rating}"
                                    displayOnly="true"
                                    visible="{= !${productDetailsView>/IsEditMode}}"
                                />
                            </l:VerticalLayout>
                        </f:content>
                    </f:SimpleForm>
                </ObjectPageSubSection>
            </ObjectPageSection>

            <ObjectPageSection
                id="idSuppliersSection"
                title="{i18n>Suppliers}"
                titleUppercase="false"
            >
                <ObjectPageSubSection>
                    <m:Text text="Suppliers" />
                </ObjectPageSubSection>
            </ObjectPageSection>

            <ObjectPageSection
                id="idCommentsSection"
                title="{i18n>Comments}"
                titleUppercase="false"
                visible="{= !${productDetailsView>/IsCreateMode}}"
            >
                <ObjectPageSubSection>
                    <m:Text text="Comments" />
                </ObjectPageSubSection>
            </ObjectPageSection>
        </sections>

        <footer>
            <m:Toolbar>
                <m:ToolbarSpacer />
                <m:Button
                    id="idSaveProductButton"
                    type="Emphasized"
                    text="{i18n>Save}"
                    enabled="{productDetailsView>/IsProductFormValid}"
                    press="onSaveProductButtonPress"
                />
                <m:Button
                    id="idCancelProductEditingButton"
                    type="Default"
                    text="{i18n>Cancel}"
                    press="onCancelProductEditingButtonPress"
                />
            </m:Toolbar>
        </footer>
    </ObjectPageLayout>
</mvc:View>
