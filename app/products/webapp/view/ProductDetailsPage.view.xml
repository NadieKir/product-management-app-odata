<mvc:View
    controllerName="productmanagement.products.controller.ProductDetailsPage"
    xmlns:mvc="sap.ui.core.mvc"
    xmlns="sap.uxap"
    xmlns:l="sap.ui.layout"
    xmlns:tnt="sap.tnt"
    xmlns:m="sap.m"
    xmlns:core="sap.ui.core"
    xmlns:f="sap.ui.layout.form"
    core:require="{ formatMessage: 'sap/base/strings/formatMessage' }"
    height="100%"
>
    <ObjectPageLayout
        id="idProductPage"
        enableLazyLoading="true"
        showTitleInHeaderContent="false"
        showHeaderContent="{= !${productDetailsView>/IsCreateMode}}"
        showFooter="{productDetailsView>/IsEditMode}"
    >
        <headerTitle>
            <ObjectPageDynamicHeaderTitle>
                <expandedHeading>
                    <m:HBox alignItems="Center">
                        <m:Title
                            text="{= ${products>Name} || ${i18n>CreateProduct}}"
                            wrapping="true"
                        />
                        <tnt:InfoLabel
                            text="{i18n>New.Uppercase}"
                            colorScheme="8"
                            visible="{
                                path: 'products>ReleaseDate',
                                formatter: '.formatter.isNewFormatter'
                            }"
                            class="sapUiSmallMarginBegin"
                        />
                    </m:HBox>
                </expandedHeading>

                <snappedHeading>
                    <m:FlexBox
                        fitContainer="true"
                        alignItems="Center"
                    >
                        <m:Avatar
                            src="{products>Image}"
                            class="sapUiSmallMarginEnd"
                            visible="{= !${productDetailsView>/IsCreateMode}}"
                        />
                        <m:Title
                            text="{= ${products>Name} || ${i18n>CreateProduct}}"
                            wrapping="true"
                        />
                        <tnt:InfoLabel
                            text="{i18n>New.Uppercase}"
                            colorScheme="8"
                            visible="{
                                path: 'products>ReleaseDate',
                                formatter: '.formatter.isNewFormatter'
                            }"
                            class="sapUiSmallMarginBegin"
                        />
                    </m:FlexBox>
                </snappedHeading>

                <expandedContent>
                    <m:Text
                        text="{products>Description}"
                        visible="{= !${productDetailsView>/IsCreateMode}}"
                    />
                </expandedContent>

                <snappedContent>
                    <m:Text
                        text="{products>Description}"
                        visible="{= !${productDetailsView>/IsCreateMode}}"
                    />
                </snappedContent>

                <snappedTitleOnMobile>
                    <m:Title
                        text="{products>Description}"
                        visible="{= !${productDetailsView>/IsCreateMode}}"
                    />
                </snappedTitleOnMobile>

                <actions>
                    <m:Button
                        id="idEditProductButton"
                        type="Emphasized"
                        text="{i18n>Edit}"
                        icon="sap-icon://edit"
                        press="setEditMode"
                        visible="{= !${productDetailsView>/IsEditMode}}"
                    />
                    <m:Button
                        id="idDeleteProductButton"
                        type="Default"
                        text="{i18n>Delete}"
                        icon="sap-icon://delete"
                        press="onDeleteProductButtonPress"
                        visible="{= !${productDetailsView>/IsCreateMode}}"
                    />
                </actions>
            </ObjectPageDynamicHeaderTitle>
        </headerTitle>

        <headerContent>
            <m:FlexBox
                wrap="Wrap"
                fitContainer="true"
                alignItems="Center"
            >
                <m:Avatar
                    class="sapUiLargeMarginEnd sapUiSmallMarginBottom"
                    src="{products>Image}"
                    displaySize="L"
                />

                <m:VBox class="sapUiMediumMarginEnd sapUiSmallMarginBottom">
                    <m:Title text="{i18n>Price}" />
                    <m:ObjectNumber
                        class="sapMObjectNumberLarge"
                        number="{
                            parts: ['products>Price'],
                            type: 'sap.ui.model.type.Currency',
                            formatOptions: {currencyCode : false, groupingSeparator: ' ', decimals: 0 }
                        }"
                        unit="USD"
                        state="Information"
                    />
                </m:VBox>

                <m:VBox
                    class="sapUiMediumMarginEnd sapUiSmallMarginBottom"
                    visible="{= !!${products>DiscountDate}}"
                >
                    <m:Title text="{i18n>Status}" />
                    <m:ObjectStatus
                        class="sapMObjectStatusLarge"
                        text="{i18n>Sale.Uppercase}"
                        state="Success"
                    />
                </m:VBox>

                <m:VBox class="sapUiMediumMarginEnd sapUiSmallMarginBottom">
                    <m:Title text="{i18n>ReleaseDate}" />
                    <m:ObjectStatus
                        class="sapMObjectStatusLarge"
                        text="{
                            path: 'products>ReleaseDate',
                            formatter: '.formatter.jsonDateStringFormatter'
                        }"
                    />
                </m:VBox>

                <m:VBox class="sapUiMediumMarginEnd sapUiSmallMarginBottom">
                    <m:Title text="{i18n>OnMarket}" />
                    <m:ObjectStatus
                        class="sapMObjectStatusLarge"
                        text="{
                            parts: [
                                'i18n>Days.WithAmount',
                                {
                                    path: 'products>ReleaseDate',
                                    formatter: '.formatter.passedDaysFormatter'
                                }
                            ],
                            formatter: 'formatMessage'
                          }"
                    />
                </m:VBox>
            </m:FlexBox>
        </headerContent>

        <sections>
            <ObjectPageSection
                id="idDetailsSection"
                title="{i18n>Details}"
                titleUppercase="false"
            >
                <ObjectPageSubSection>
                    <f:SimpleForm
                        id="idProductForm"
                        editable="{productDetailsView>/IsEditMode}"
                        layout="ResponsiveGridLayout"
                        adjustLabelSpan="false"
                        labelSpanXL="3"
                        labelSpanL="3"
                        labelSpanM="3"
                        labelSpanS="12"
                        emptySpanXL="2"
                        emptySpanL="2"
                        emptySpanM="2"
                        emptySpanS="0"
                        columnsXL="1"
                        columnsL="1"
                        columnsM="1"
                        validateFieldGroup="onProductDataFieldGroupValidate"
                    >
                        <f:content>
                            <m:Label
                                text="{i18n>Name}"
                                required="{productDetailsView>/IsEditMode}"
                            />
                            <l:VerticalLayout>
                                <m:Input
                                    name="Name"
                                    fieldGroupIds="ProductDataField,ProductName"
                                    placeholder="{i18n>ProductNamePlaceholder}"
                                    value="{
                                        path : 'editableProduct>/Name',
                                        type : 'sap.ui.model.type.String',
                                        constraints : {
                                            minLength: 2
                                        }
                                    }"
                                    visible="{productDetailsView>/IsEditMode}"
                                    required="true"
                                />
                                <m:Text
                                    text="{products>Name}"
                                    visible="{= !${productDetailsView>/IsEditMode}}"
                                />
                            </l:VerticalLayout>

                            <m:Label
                                text="{i18n>Price}"
                                required="{productDetailsView>/IsEditMode}"
                            />
                            <l:VerticalLayout>
                                <m:Input
                                    name="Price"
                                    type="Number"
                                    fieldGroupIds="ProductDataField,Price"
                                    placeholder="{i18n>PricePlaceholder}"
                                    value="{
                                        path : 'editableProduct>/Price',
                                        type : 'sap.ui.model.type.Float',
                                        formatOptions: { groupingSeparator: '', decimals: 0, decimalSeparator: '.' }
                                    }"
                                    textAlign="Right"
                                    description="USD"
                                    visible="{productDetailsView>/IsEditMode}"
                                    required="true"
                                />
                                <m:Text
                                    text="{
                                        parts: [{ path: 'products>Price' }, { value: 'USD' }],
                                        type: 'sap.ui.model.type.Currency',
                                        formatOptions: { currencyCode : true, groupingSeparator: ' ', decimals: 0, decimalSeparator: '.' }
                                    }"
                                    visible="{= !${productDetailsView>/IsEditMode}}"
                                />
                            </l:VerticalLayout>

                            <m:Label
                                text="{i18n>Categories}"
                                required="{productDetailsView>/IsEditMode}"
                            />
                            <l:VerticalLayout>
                                <m:MultiComboBox
                                    name="Categories"
                                    fieldGroupIds="ProductDataField,Categories"
                                    placeholder="{i18n>CategoryPlaceholder}"
                                    items="{
                                        path: 'categories>/',
                                        sorter: { path: 'Name' }
                                    }"
                                    selectedKeys="{editableProduct>/Categories}"
                                    visible="{productDetailsView>/IsEditMode}"
                                    selectionChange="validateRequiredMultiComboBox"
                                    required="true"
                                >
                                    <core:Item
                                        key="{categories>Id}"
                                        text="{categories>Name}"
                                    />
                                </m:MultiComboBox>
                                <m:Text
                                    text="{
                                        parts: [{ path: 'products>Categories' }, { value: 'Name' }],                                       
                                        formatter: '.formatter.joinFormatter'
                                    }"
                                    visible="{= !${productDetailsView>/IsEditMode}}"
                                />
                            </l:VerticalLayout>

                            <m:Label
                                text="{i18n>Description}"
                                required="{productDetailsView>/IsEditMode}"
                            />
                            <l:VerticalLayout>
                                <m:TextArea
                                    name="Description"
                                    fieldGroupIds="ProductDataField,Description"
                                    placeholder="{i18n>DescriptionPlaceholder}"
                                    width="100%"
                                    value="{
                                        path : 'editableProduct>/Description',
                                        type : 'sap.ui.model.type.String',
                                        constraints : {
                                            minLength: 5,
                                            maxLength: 70
                                        }
                                    }"
                                    growing="true"
                                    visible="{productDetailsView>/IsEditMode}"
                                    required="true"
                                />
                                <m:Text
                                    text="{products>Description}"
                                    emptyIndicatorMode='On'
                                    visible="{= !${productDetailsView>/IsEditMode}}"
                                />
                            </l:VerticalLayout>

                            <m:Label
                                text="{i18n>ReleaseDate}"
                                required="{productDetailsView>/IsEditMode}"
                            />
                            <l:VerticalLayout>
                                <m:DatePicker
                                    name="ReleaseDate"
                                    fieldGroupIds="ProductDataField,ReleaseDate"
                                    value="{
                                        path: 'editableProduct>/ReleaseDate',
                                        type: 'custom.type.RequiredDate'
                                    }"
                                    maxDate="{editableProduct>/SupportData/MaxReleaseDate}"
                                    visible="{productDetailsView>/IsEditMode}"
                                    required="true"
                                    change="onReleaseDatePickerChange"
                                />
                                <m:Text
                                    text="{
                                        path: 'products>ReleaseDate',                        
                                        formatter: '.formatter.jsonDateStringFormatter'
                                    }"
                                    visible="{= !${productDetailsView>/IsEditMode}}"
                                />
                            </l:VerticalLayout>

                            <m:Label text="{i18n>DiscountDate}" />
                            <l:VerticalLayout>
                                <m:DatePicker
                                    id="idDiscountDate"
                                    name="DiscountDate"
                                    fieldGroupIds="ProductDataField,DiscountDate"
                                    value="{
                                        path: 'editableProduct>/DiscountDate',
                                        type: 'sap.ui.model.type.Date'
                                    }"
                                    maxDate="{editableProduct>/SupportData/MaxDiscountDate}"
                                    minDate="{editableProduct>/SupportData/MinDiscountDate}"
                                    visible="{productDetailsView>/IsEditMode}"
                                />
                                <m:Text
                                    text="{
                                        path: 'products>DiscountDate',
                                        formatter: '.formatter.jsonDateStringFormatter'
                                    }"
                                    emptyIndicatorMode='On'
                                    visible="{= !${productDetailsView>/IsEditMode}}"
                                />
                            </l:VerticalLayout>

                            <m:Label text="{i18n>Rating}" />
                            <l:VerticalLayout>
                                <m:RatingIndicator
                                    fieldGroupIds="ProductDataField,Rating"
                                    value="{editableProduct>/Rating}"
                                    displayOnly="false"
                                    visible="{productDetailsView>/IsEditMode}"
                                />
                                <m:RatingIndicator
                                    value="{products>Rating}"
                                    displayOnly="true"
                                    visible="{= !${productDetailsView>/IsEditMode}}"
                                />
                            </l:VerticalLayout>
                        </f:content>
                    </f:SimpleForm>
                </ObjectPageSubSection>
            </ObjectPageSection>

            <ObjectPageSection
                id="idSuppliersSection"
                title="{i18n>Suppliers}"
                titleUppercase="false"
            >
                <ObjectPageSubSection>
                    <m:Table
                        id="idSuppliersTable"
                        items="{products>Suppliers}"
                        autoPopinMode="true"
                        fixedLayout="false"
                        sticky="HeaderToolbar,ColumnHeaders"
                        noDataText='{i18n>ProductSuppliersNoDataText}'
                    >
                        <m:headerToolbar>
                            <m:OverflowToolbar
                                visible="{productDetailsView>/IsEditMode}"
                            >
                                <m:ToolbarSpacer />
                                <m:Button
                                    id="idAddSupplierButton"
                                    text="{i18n>Add}"
                                    type="Emphasized"
                                    icon="sap-icon://add"
                                    press="onAddSupplierButtonPress"
                                />
                            </m:OverflowToolbar>
                        </m:headerToolbar>
                        <m:columns>
                            <m:Column importance="High">
                                <m:Text text="{i18n>Name}" />
                            </m:Column>
                            <m:Column
                                importance="Medium"
                                autoPopinWidth="12"
                            >
                                <m:Text text="{i18n>Country}" />
                            </m:Column>
                            <m:Column
                                importance="Low"
                                autoPopinWidth="12"
                            >
                                <m:Text text="{i18n>State}" />
                            </m:Column>
                            <m:Column
                                importance="Medium"
                                autoPopinWidth="12"
                            >
                                <m:Text text="{i18n>City}" />
                            </m:Column>
                            <m:Column
                                importance="Low"
                                autoPopinWidth="12"
                            >
                                <m:Text text="{i18n>Street}" />
                            </m:Column>
                            <m:Column
                                importance="Low"
                                autoPopinWidth="12"
                            >
                                <m:Text text="{i18n>ZipCode}" />
                            </m:Column>
                            <m:Column
                                importance="High"
                                visible="{productDetailsView>/IsEditMode}"
                            />
                        </m:columns>
                        <m:items>
                            <m:ColumnListItem vAlign="Middle">
                                <m:Text text="{products>Name}" />
                                <m:Text text="{products>Country}" />
                                <m:Text text="{products>State}" />
                                <m:Text text="{products>City}" />
                                <m:Text text="{products>Street}" />
                                <m:Text text="{products>ZipCode}" />
                                <m:HBox justifyContent="End">
                                    <m:Button
                                        type="Transparent"
                                        icon="sap-icon://sys-cancel"
                                        tooltip="{i18n>Delete}"
                                        press="onDeleteSupplierButtonPress"
                                    />
                                </m:HBox>
                            </m:ColumnListItem>
                        </m:items>
                    </m:Table>
                </ObjectPageSubSection>
            </ObjectPageSection>

            <ObjectPageSection
                id="idCommentsSection"
                title="{i18n>Comments}"
                titleUppercase="false"
                visible="{= !${productDetailsView>/IsCreateMode}}"
            >
                <ObjectPageSubSection>
                    <m:VBox>
                        <m:FeedInput
                            id="idProductCommentField"
                            class="sapUiSmallMarginBottom sapUiTinyMarginTop"
                            post="onCommentPost"
                            showIcon="false"
                            placeholder="{i18n>CommentPlaceholder}"
                            visible="{= !${productDetailsView>/IsEditMode}}"
                        />
                        <m:List
                            id="idCommentsList"
                            showSeparators="Inner"
                            items="{
                                path: 'products>Comments',
                                sorter: { path: 'Date', descending: true }
                            }"
                            noDataText='{i18n>ProductCommentsNoDataText}'
                        >
                            <m:FeedListItem
                                showIcon="false"
                                sender="{products>Author}"
                                senderActive="false"
                                timestamp="{
                                    path: 'products>Date',
                                    formatter: '.formatter.jsonDateStringFormatter'
                                }"
                                text="{products>Text}"
                            />
                        </m:List>
                    </m:VBox>
                </ObjectPageSubSection>
            </ObjectPageSection>
        </sections>

        <footer>
            <m:Toolbar>
                <m:Button
                    id="idMessagePopoverButton"
                    visible="{= !!${message>/}.length}"
                    type="{ 
                        path: 'message>/', 
                        formatter: '.formatter.messagePopoverButtonTypeFormatter' 
                    }"
                    icon="{ 
                        path: 'message>/',  
                        formatter: '.formatter.messagePopoverButtonIconFormatter' 
                    }"
                    text="{ 
                        path: 'message>/', 
                        formatter: '.formatter.highestSeverityMessagesAmountFormatter' 
                    }"
                    press="onMessagePopoverButtonPress"
                    ariaHasPopup="Dialog"
                />
                <m:ToolbarSpacer />
                <m:Button
                    id="idSaveProductButton"
                    type="Emphasized"
                    text="{i18n>Save}"
                    enabled="{productDetailsView>/IsProductFormValid}"
                    press="onSaveProductButtonPress"
                />
                <m:Button
                    id="idCancelProductEditingButton"
                    type="Default"
                    text="{i18n>Cancel}"
                    press="onCancelProductEditingButtonPress"
                />
            </m:Toolbar>
        </footer>
    </ObjectPageLayout>
</mvc:View>
